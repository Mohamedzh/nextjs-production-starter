# Nixpacks configuration for Railway deployment

[phases.setup]
nixPkgs = ["...", "openssl"]

[phases.install]
# Install dependencies
cmds = ["npm ci"]

[phases.build]
# Conditionally generate Prisma Client if DATABASE_URL is set
# Then build Next.js application
cmds = [
  "if [ -n \"$DATABASE_URL\" ]; then echo '✓ DATABASE_URL detected - generating Prisma Client...' && npx prisma generate; else echo '⚠ Skipping Prisma generation (DATABASE_URL not set)'; fi",
  "npm run build"
]

[start]
cmd = "npm start"

[variables]
# Use the generic "20" to get the latest stable version (e.g. 20.28)
NIXPACKS_NODE_VERSION = "20"
NEXT_TELEMETRY_DISABLED = "1"
NODE_ENV = "production"